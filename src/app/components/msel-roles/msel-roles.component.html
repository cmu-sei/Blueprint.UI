<!--
Copyright 2022 Carnegie Mellon University. All Rights Reserved.
Released under a MIT (SEI)-style license, please see LICENSE.md in the
project root for license information or contact permission@sei.cmu.edu for full terms.
-->
<div *ngIf="msel" class="scrolling-region">
  <div class="cssLayoutRowStartCenter">
    <button
      mat-icon-button
      (click)="addOrEditTeam(null)"
      style="outline: none; margin-left: 20px;"
      title="Add Team"
    >
      <mat-icon class="mdi-24px self-center" fontIcon="mdi-plus-circle"></mat-icon>
    </button>
    <mat-form-field style="width: 300px; margin-left: 10px;">
      <input
        matInput
        [(ngModel)]="filterString"
        (keyup)="applyFilter($any($event.target).value)"
        placeholder="Search"
      />
    </mat-form-field>
    <div style="width: 30px;">
      <button
        mat-icon-button
        (click)="applyFilter('')"
        style="outline: none;"
        title="Clear Search"
      >
        <mat-icon class="mdi-24px" fontIcon="mdi-close-circle-outline"></mat-icon>
      </button>
    </div>
  </div>
  <div class="mat-elevation-z2 section-container">
    <div class="section-content">
      <mat-expansion-panel
        *ngFor="let team of teamList; trackBy: trackByFn"
      >
        <mat-expansion-panel-header
          (click)="$event.stopPropagation();"
        >
          <button
            mat-icon-button
            (click)="deleteTeam(team); $event.stopPropagation();"
            title="Delete team"
            *ngIf="isContentDeveloper || msel.hasRole(loggedInUserId, null).owner"
          >
            <mat-icon class="mdi-24px self-center" fontIcon="mdi-trash-can"></mat-icon>
          </button>
          <span class="center-self">{{ team.shortName }} - {{ team.name }}</span>
        </mat-expansion-panel-header>
        <div class="team-detail" *ngFor="let user of team.users">
          <div class="user-name four-cell">{{ user.name }}</div>
          <div class="msel-role one-cell" *ngFor="let teamRole of getTeamRolesToDisplay()">
            <mat-checkbox
              [checked]="hasTeamRole(user.id, team.id, teamRole)"
              (change)="toggleTeamRole(user.id, team.id, teamRole, $event.checked)"
              (click)="$event.stopPropagation();"
              style="margin-right: 20px;"
              [disabled]="!isContentDeveloper && !msel.hasRole(loggedInUserId, null).owner"
              >{{ teamRole }}</mat-checkbox
            >
          </div>
        </div>
        <div class="team-detail" *ngIf="team.users?.length === 0">This team has no users.</div>
        <div class="team-detail" *ngIf="msel.useCite">
          <mat-form-field class="button-margins half-width">
            <mat-label>CITE Team Type</mat-label>
            <mat-select
              [value]="team.citeTeamTypeId"
              (selectionChange)="setTeamType(team, $event.value)"
            >
              <mat-option [value]="''"></mat-option>
              <mat-option *ngFor="let teamType of teamTypeList" [value]="teamType.id">
                {{ teamType.name }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div class="team-detail" *ngIf="msel.useCite">
          <mat-form-field class="button-margins half-width">
            <mat-label>Team Email</mat-label>
            <input
              type="text"
              matInput
              placeholder="Header Row Metadata (Height)"
              [(ngModel)]="team.email"
              (blur)="saveTeam(team)"
              title="Team Email"
            />
          </mat-form-field>
        </div>
      </mat-expansion-panel>
    </div>
  </div>
</div>
