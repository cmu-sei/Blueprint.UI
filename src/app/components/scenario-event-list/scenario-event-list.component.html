<!--
Copyright 2022 Carnegie Mellon University. All Rights Reserved.
Released under a MIT (SEI)-style license, please see LICENSE.md in the
project root for license information or contact permission@sei.cmu.edu for full terms.
-->
<div *ngIf="msel">
  <table>
    <thead>
      <tr>
        <th>
          <div class="row-start-buttons">
            <button
              mat-icon-button
              (click)="addScenarioEvent()"
              style="outline: none; margin-right: 15px;"
              title="Add new inject"
              *ngIf="isContentDeveloper || msel.hasRole(loggedInUserId, null).owner"
            >
              <mat-icon class="mdi-24px self-center" fontIcon="mdi-plus-circle-outline"></mat-icon>
            </button>
          </div>
        </th>
        <ng-container *ngFor="let df of sortedDataFields">
          <th>
            <div [style]="getStyle(df)">{{ df.name }}</div>
          </th>
        </ng-container>
      </tr>
    </thead>
    <tbody>
      <ng-container *ngFor="let item of sortedScenarioEvents">
        <tr [style]="getRowStyle(item)">
          <td class="row-start-buttons">
            <div class="row-start-buttons">
              <button
                mat-icon-button
                class="scenario-event-button"
                (click)="editScenarioEvent(item)"
                title="Edit this inject"
              >
                <mat-icon class="mdi-18px up-12" fontIcon="mdi-square-edit-outline"></mat-icon>
              </button>
              <button
                mat-icon-button
                class="scenario-event-button"
                [matMenuTriggerFor]="menu"
                (click)="$event.stopPropagation()"
                title="Change highlight color"
                *ngIf="isContentDeveloper || msel.hasRole(loggedInUserId, item.id).owner"
              >
                <mat-icon class="mdi-18px up-12" fontIcon="mdi-format-color-fill"></mat-icon>
              </button>
              <mat-menu #menu="matMenu" [overlapTrigger]="false">
                <button
                  mat-menu-item
                  (click)="selectNewColor('', item)"
                  class="color-option-button"
                >
                <div class="color-option" [style]="getStyleFromColor('')"></div>
                </button>
                <button
                  mat-menu-item
                  *ngFor="let color of scenarioEventBackgroundColors"
                  (click)="selectNewColor(color, item)"
                  class="color-option-button"
                >
                  <div class="color-option" [style]="getStyleFromColor(color)">&nbsp;</div>
                </button>
              </mat-menu>
              <button
                mat-icon-button
                class="scenario-event-button"
                (click)="copyScenarioEvent(item)"
                title="Duplicate this inject"
                *ngIf="isContentDeveloper || msel.hasRole(loggedInUserId, item.id).owner"
              >
                <mat-icon class="mdi-18px up-12" fontIcon="mdi-content-copy"></mat-icon>
              </button>
              <button
                mat-icon-button
                class="scenario-event-button"
                (click)="deleteScenarioEvent(item)"
                title="Delete this inject"
                *ngIf="isContentDeveloper || msel.hasRole(loggedInUserId, item.id).owner"
              >
                <mat-icon class="mdi-18px up-12" fontIcon="mdi-delete"></mat-icon>
              </button>
              <span class="row-index center-self">{{ item.rowIndex }}</span>
            </div>
          </td>
          <ng-container *ngFor="let df of sortedDataFields">
            <!-- HTML value -->
            <td *ngIf="df.dataType.toString() === 'Html'">
              <div class="html-constrainer" [style]="getStyle(df)">
                <quill-view-html [content]="getScenarioEventValue(item, df.name)" theme="snow"></quill-view-html>
              </div>
            </td>
            <!-- Organization value -->
            <td *ngIf="df.dataType.toString() === 'Organization'">
              <div class="constrainer" [style]="getStyle(df)">
                <mat-select
                  *ngIf="isContentDeveloper || msel.hasRole(loggedInUserId, item.id).editor"
                  (click)="$event.stopPropagation()"
                  (valueChange)="saveDataValue(item, df.name, $event)"
                  class="header-dropdown"
                  placeholder="None"
                  [(ngModel)]="getDataValue(item, df.name).value"
                >
                  <mat-option value="None">None</mat-option>
                  <mat-option *ngFor="let org of getSortedOrganizationOptions()" [value]="org">
                    {{ org }}
                  </mat-option>
                </mat-select>
                <span *ngIf="!isContentDeveloper && !msel.hasRole(loggedInUserId, item.id).editor">{{ getDataValue(item, df.name).value }}</span>
              </div>
            </td>
            <!-- TeamsMultiple value -->
            <td *ngIf="df.dataType.toString() === 'TeamsMultiple'">
              <div class="constrainer" [style]="getStyle(df)">
                <mat-select
                  multiple
                  *ngIf="isContentDeveloper || msel.hasRole(loggedInUserId, item.id).editor"
                  (click)="$event.stopPropagation()"
                  (valueChange)="saveDataValueArray(item, df.name, $event)"
                  class="header-dropdown"
                  placeholder="None"
                  [(ngModel)]="getDataValue(item, df.name).valueArray"
                >
                <mat-option value="None">None</mat-option>
                <mat-option value="ALL">ALL</mat-option>
                <mat-option *ngFor="let org of getSortedOrganizationOptions()" [value]="org">
                    {{ org }}
                  </mat-option>
                </mat-select>
                <span *ngIf="!isContentDeveloper && !msel.hasRole(loggedInUserId, item.id).editor">{{ getDataValue(item, df.name).value }}</span>
              </div>
            </td>
            <!-- Status value -->
            <td *ngIf="df.dataType.toString() === 'Status'">
              <div class="constrainer" [style]="getStyle(df)">
                <mat-select
                  *ngIf="isContentDeveloper || msel.hasRole(loggedInUserId, item.id).approver"
                  [(ngModel)]="getDataValue(item, df.name).value"
                  (click)="$event.stopPropagation()"
                  (valueChange)="saveDataValue(item, df.name, $event)"
                  class="header-dropdown"
                  placeholder="None"
                >
                  <mat-option *ngFor="let status of itemStatus" [value]="status">
                    {{ status }}
                  </mat-option>
                </mat-select>
                <span *ngIf="!isContentDeveloper && !msel.hasRole(loggedInUserId, item.id).approver">{{ getDataValue(item, df.name).value }}</span>
              </div>
            </td>
            <!-- Assigned Team value -->
            <td *ngIf="df.dataType.toString() === 'Team'">
              <div class="constrainer" [style]="getStyle(df)">
                <mat-select
                  *ngIf="isContentDeveloper || msel.hasRole(loggedInUserId, item.id).owner"
                  [(ngModel)]="getDataValue(item, df.name).value"
                  (click)="$event.stopPropagation()"
                  (valueChange)="saveDataValue(item, df.name, $event)"
                  class="header-dropdown"
                  placeholder="None"
                >
                  <mat-option *ngFor="let team of msel.teams" [value]="team.shortName">
                    {{ team.shortName }}
                  </mat-option>
                </mat-select>
                <span *ngIf="!isContentDeveloper && !msel.hasRole(loggedInUserId, item.id).owner">{{ getDataValue(item, df.name).value }}</span>
              </div>
            </td>
            <!-- datetime value -->
            <td *ngIf="df.dataType.toString() === 'DateTime'">
              <div class="constrainer" [style]="getStyle(df)">
                {{ getScenarioEventValue(item, df.name) | date :'MM/dd/yyyy HH:mm'}}
              </div>
            </td>
            <!-- other values -->
            <td *ngIf="df.dataType.toString() !== 'Html' &&
                        df.dataType.toString() !== 'Organization' &&
                        df.dataType.toString() !== 'TeamsMultiple' &&
                        df.dataType.toString() !== 'Team' &&
                        df.dataType.toString() !== 'DateTime' &&
                        df.dataType.toString() !== 'Status'">
              <div class="constrainer" [style]="getStyle(df)">
                {{ getScenarioEventValue(item, df.name) }}
              </div>
            </td>
          </ng-container>
        </tr>
      </ng-container>
    </tbody>
  </table>
</div>

